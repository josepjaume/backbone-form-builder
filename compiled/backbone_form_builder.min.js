(function(){var c,a=Object.prototype.hasOwnProperty,b=function(g,e){for(var d in e){if(a.call(e,d)){g[d]=e[d]}}function f(){this.constructor=g}f.prototype=e.prototype;g.prototype=new f;g.__super__=e.prototype;return g};require("../fields");Backbone.FormBuilder.Fields.Text=(function(e){b(d,e);function d(){d.__super__.constructor.apply(this,arguments)}d.prototype.input=Backbone.FormBuilder.Inputs.Text;return d})(Backbone.FormBuilder.Fields.Base);require("./inputs.coffee");(c=Backbone.FormBuilder).Fields||(c.Fields={});Backbone.FormBuilder.Fields.Base=(function(e){b(d,e);function d(){d.__super__.constructor.apply(this,arguments)}d.prototype.initialize=function(f){if(f==null){f={}}return this.options=f};d.prototype.className="field";d.prototype.render=function(){var f;$(this.el).html("");f=this.input(this);f.attr("id",this.inputId());$(this.el).append(this.label());return $(this.el).append(f)};d.prototype.value=function(){return this.model.get(this.name)};d.prototype.input=Backbone.FormBuilder.Inputs.Text;d.prototype.label=function(){var f;f=$("<label/>");f.attr("for",this.inputId());if(this.options.label){f.html(this.options.label)}else{f.html(Backbone.FormBuilder.labelMethod(this.modelName,this.name))}return f};d.prototype.inputId=function(){return""+(this.modelName())+"_"+this.name};d.prototype.modelName=function(){return this.model.constructor.name};d.prototype.renderErrors=function(f){if(f==null){f=[]}if(!this.error_container){this.error_container=$("<div class='errors'/>");$(this.el).append(this.error_container)}if(f.length>0){return this.error_container.html(f.join(", "))}else{return this.error_container.remove()}};return d})(Backbone.View);Backbone.FormBuilder.Form=(function(e){b(d,e);function d(){d.__super__.constructor.apply(this,arguments)}d.prototype.tagName="form";d.prototype.initialize=function(f){var g,h=this;this.fields||(this.fields=[]);g={success:f.success,error:f.error};return $(this.el).submit(function(){h.save(g);return false})};d.prototype.formData=function(){var k,g,f,j,i,h;g=$(this.el).serializeArray();f={};for(i=0,h=g.length;i<h;i++){k=g[i];j=k.value||"";f[k.name]=j}return f};d.prototype.save=function(f){var g;if(f==null){f={}}g=this;this.model.set(this.formData());return this.model.save({success:f.success,error:function(i,h){if(f.error){f.error(this.model)}return g.renderErrors(h)}})};d.prototype.render=function(){var j,i,g,h,f;$(this.el).html("");h=this.fields;f=[];for(i=0,g=h.length;i<g;i++){j=h[i];j.render();f.push($(this.el).append(j.el))}return f};d.prototype.renderErrors=function(l){var k,h,j,g,i,f;i=this.fields;f=[];for(j=0,g=i.length;j<g;j++){k=i[j];if(h=l[k.name]){f.push(k.renderErrors(h))}else{f.push(void 0)}}return f};d.prototype.addField=function(g,h,f){var i;if(f==null){f={}}i=new Backbone.FormBuilder.Fields[this.camelize(h)](f);i.model=this.model;i.name=g;this.fields.push(i);return i};d.prototype.camelize=function(f){return f.replace(/(?:^|[-_])(\w)/g,function(g,h){if(h){return h.toUpperCase()}})};d.prototype.parseErrors=Backbone.FormBuilder.parseErrors;return d})(Backbone.View);Backbone.FormBuilder.Inputs={Text:function(f,e){var d;if(e==null){e={}}d=$("<input />");d.attr("name",f.name);d.attr("type","text");d.attr("value",f.value());return d},TextArea:function(f,e){var d;if(e==null){e={}}d=$("<textarea>");d.attr("name",f.name);d.html(f.value());return d}};Backbone.FormBuilder={labelMethod:function(d,e){return""+e},parseErrors:function(d){return d.errors}}}).call(this);