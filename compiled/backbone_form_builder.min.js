(function(){var d,a=Object.prototype.hasOwnProperty,c=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g;h.__super__=f.prototype;return h},b=Array.prototype.indexOf||function(g){for(var f=0,e=this.length;f<e;f++){if(f in this&&this[f]===g){return f}}return -1};Backbone.FormBuilder={labelMethod:function(e,f){return Backbone.FormBuilder.camelize(""+f)},parseErrors:function(e){return JSON.parse(e).errors},camelize:function(e){return e.replace(/(?:^|[-_])(\w)/g,function(f,g){if(g){return g.toUpperCase()}})},underscore:function(e){return e.replace(/([a-z\d])([A-Z]+)/g,"$1_$2").toLowerCase()}};Backbone.FormBuilder.Form=(function(f){c(e,f);function e(){e.__super__.constructor.apply(this,arguments)}e.prototype.tagName="form";e.prototype.initialize=function(g){var h,i=this;this.fields||(this.fields=[]);h={success:g.success,error:g.error};return $(this.el).submit(function(){i.save(h);return false})};e.prototype.formData=function(){var l,h,g,k,j,i;h=$(this.el).serializeArray();g={};for(j=0,i=h.length;j<i;j++){l=h[j];k=l.value||"";g[l.name]=k}return g};e.prototype.save=function(g){var j,i,h;if(g==null){g={}}i=this;h=this.modelKey();j={};j[h]=this.formData();return this.model.save(j,{success:g.success,error:function(l,k){var m;if(g.error){g.error(this.model)}m=i.parseErrors(k.responseText);return i.renderErrors(m)}})};e.prototype.modelKey=function(){return Backbone.FormBuilder.underscore(this.model.constructor.name)};e.prototype.render=function(){var j,i,g,h;$(this.el).html("");h=this.fields;for(i=0,g=h.length;i<g;i++){j=h[i];j.render();$(this.el).append(j.el)}return this};e.prototype.renderErrors=function(l){var k,j,h,i,g;i=this.fields;g=[];for(j=0,h=i.length;j<h;j++){k=i[j];g.push(k.renderErrors(l[k.name]))}return g};e.prototype.addField=function(h,i,g){var j;if(g==null){g={}}j=new Backbone.FormBuilder.Fields[Backbone.FormBuilder.camelize(i)](g);j.model=this.model;j.name=h;this.fields.push(j);return j};e.prototype.parseErrors=Backbone.FormBuilder.parseErrors;return e})(Backbone.View);(d=Backbone.FormBuilder).Fields||(d.Fields={});Backbone.FormBuilder.Fields.Base=(function(f){c(e,f);function e(){e.__super__.constructor.apply(this,arguments)}e.prototype.initialize=function(g){if(g==null){g={}}return this.options=g};e.prototype.className="field";e.prototype.render=function(){var g;$(this.el).html("");g=this.input(this.name,this.value(),this.options);g.attr("id",this.inputId());if(this.options.label!==false){$(this.el).append(this.label())}return $(this.el).append(g)};e.prototype.value=function(){return this.model.get(this.name)};e.prototype.input=function(h,i){var g;g=$("<input />");g.attr("name",h);g.attr("type","text");g.attr("value",i);return g};e.prototype.label=function(){var g;g=$("<label/>");g.attr("for",this.inputId());if(this.options.label){g.html(this.options.label)}else{g.html(Backbone.FormBuilder.labelMethod(this.modelName(),this.name))}return g};e.prototype.inputId=function(){return""+(this.modelName())+"_"+this.name};e.prototype.modelName=function(){return Backbone.FormBuilder.underscore(this.model.constructor.name)};e.prototype.renderErrors=function(g){if(g==null){g=[]}if(!this.error_container){this.error_container=$("<div class='errors'/>");$(this.el).append(this.error_container)}if(g.length>0){return this.error_container.html(g.join(", "))}else{this.error_container.remove();return this.error_container=void 0}};return e})(Backbone.View);Backbone.FormBuilder.Fields.TextArea=(function(e){c(f,e);function f(){f.__super__.constructor.apply(this,arguments)}f.prototype.input=function(h,i){var g;g=$("<textarea />");g.attr("name",h);g.attr("type","text");g.html(i);return g};return f})(Backbone.FormBuilder.Fields.Base);Backbone.FormBuilder.Fields.Text=(function(f){c(e,f);function e(){e.__super__.constructor.apply(this,arguments)}e.prototype.input=function(h,i){var g;g=$("<input />");g.attr("name",h);g.attr("type","text");g.attr("value",i);return g};return e})(Backbone.FormBuilder.Fields.Base);Backbone.FormBuilder.Fields.Select=(function(e){c(f,e);function f(){f.__super__.constructor.apply(this,arguments)}f.prototype.input=function(j,k,i){var h,g;if(i.multiple){g=true}h=$("<select />");if(g){h.attr("multiple","multiple")}h.attr("name",j);this.renderOptions(h,k,i.collection,g);return h};f.prototype.renderOptions=function(n,i,l,q){var j,k,p,o,h,m,g;if(q==null){q=false}if(q!==true){i=[i]}g=[];for(h=0,m=l.length;h<m;h++){j=l[h];if(j.value){o=j.value;p=j.text}else{o=p=j}k=$("<option />");k.attr("value",o);if(b.call(i,o)>=0){k.attr("selected","selected")}k.html(p);g.push(n.append(k))}return g};return f})(Backbone.FormBuilder.Fields.Base);Backbone.FormBuilder.Fields.Password=(function(f){c(e,f);function e(){e.__super__.constructor.apply(this,arguments)}e.prototype.input=function(h,i){var g;g=$("<input />");g.attr("name",h);g.attr("type","password");g.attr("value",i);return g};return e})(Backbone.FormBuilder.Fields.Base)}).call(this);